!function($){const testNowMatch=window.location.href.match(/(?:\?|&)_countdown_now=([^&]+)/),debugAddTime=testNowMatch?new Date(testNowMatch[1].replace("."," ")).getTime()-(new Date).getTime():0,timeUnit={day:864e5,hour:36e5,min:6e4,sec:1e3,ms:1},limiterTimeUnit={day:timeUnit.day/timeUnit.hour,hour:timeUnit.hour/timeUnit.min,min:timeUnit.min/timeUnit.sec,sec:timeUnit.sec/timeUnit.ms,ms:null};let renderId=0;const timeEvent=$("<div>"),timeCounterList={},timeSegmentList={},getRenderId=function(){return++renderId},initEl=function($el){let html=$el.html(),limiterUnit="";$.each(["day","hour","min","sec","ms"],(function(){const unit=this,re=new RegExp("{"+unit+"(?::(0+))?}");html.match(re)&&(html=html.replace(re,'<span class="countdown-timer countdown-timer-'+unit+'" data-countdown-timer-unit="'+unit+'" data-countdown-timer-zero="$1" data-countdown-timer-limiter="'+limiterUnit+'"></span>'),limiterUnit=limiterTimeUnit[unit])})),$el.html(html)},renderEl=function($el,countdownTime){$el.find("span.countdown-timer").each((function(index,el){const $el=$(el);timeEvent.on("render-"+countdownTime+"-"+$el.data("countdown-timer-unit")+"."+renderId,(function(e,time){const unit=$el.data("countdown-timer-unit"),limiter=$el.data("countdown-timer-limiter"),zero=$el.data("countdown-timer-zero")+"";limiter>0&&(time%=limiter),"ms"==unit?(time=("00"+time).slice(-3),zero.length&&(time=time.slice(0,zero.length))):(time+"").length<zero.length&&(time=(Array(zero.length).join("0")+time).slice(-zero.length)),$el.text(time)}))}))},resetTimeSegment=function(countdownTime){timeSegmentList[countdownTime]={day:null,hour:null,min:null,sec:null,ms:null}},timeCounter=function(countdownTime){if(resetTimeSegment(countdownTime),countdownTime in timeCounterList)return;timeCounterList[countdownTime]=!0;let start=!1;const intervalId=setInterval((function(){const now=new Date;debugAddTime&&now.setTime(now.getTime()+debugAddTime);let diffTime=countdownTime-now;diffTime<0&&(diffTime=0),$.each(["day","hour","min","sec","ms"],(function(){const unit=this,time=Math.floor(diffTime/timeUnit[unit]);timeSegmentList[countdownTime][unit]!==time&&(timeSegmentList[countdownTime][unit]=time,timeEvent.trigger("render-"+countdownTime+"-"+unit,time))})),0==diffTime&&(clearInterval(intervalId),delete timeCounterList[countdownTime],timeEvent.trigger("end-"+countdownTime))}),10)};$.fn.countdownTimer=function(end,endFunction){const countdownTime=new Date(end).getTime();return this.each((function(index,el){const $el=$(el),renderId=getRenderId();$el.data("countdown-timer-render-id")&&(timeEvent.off("."+$el.data("countdown-timer-render-id")),$el.off("."+$el.data("countdown-timer-render-id"))),$el.data("countdown-timer-render-id",renderId),initEl($el),renderEl($el,countdownTime),$.each(["day","hour","min","sec","ms"],(function(){const unit=this;timeEvent.on("render-"+countdownTime+"-"+unit+"."+renderId,(function(e,time){$el.trigger("countdownTimer:render-"+unit,time)}))})),timeEvent.on("end-"+countdownTime+"."+renderId,(function(e){timeEvent.off("."+renderId),$el.trigger("countdownTimer:end")})),"function"==typeof endFunction&&$el.on("countdownTimer:end."+renderId,endFunction)})),timeCounter(countdownTime),this}}(jQuery);